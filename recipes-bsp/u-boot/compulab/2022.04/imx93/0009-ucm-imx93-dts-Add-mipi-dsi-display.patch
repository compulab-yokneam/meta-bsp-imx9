From b7aad044152e6ff0baa7901779109542149626b8 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Fri, 7 Apr 2023 10:45:35 +0300
Subject: [PATCH] ucm-imx93: dts: Add mipi dsi display

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm/dts/ucm-imx93-u-boot.dtsi |  4 ++
 arch/arm/dts/ucm-imx93.dts         | 74 +++++++++++-------------------
 2 files changed, 31 insertions(+), 47 deletions(-)

diff --git a/arch/arm/dts/ucm-imx93-u-boot.dtsi b/arch/arm/dts/ucm-imx93-u-boot.dtsi
index 4cb77139d0..0e0d4bbded 100644
--- a/arch/arm/dts/ucm-imx93-u-boot.dtsi
+++ b/arch/arm/dts/ucm-imx93-u-boot.dtsi
@@ -196,3 +196,7 @@
 	assigned-clock-parents = <&clk IMX93_CLK_SYS_PLL_PFD1>, <&clk IMX93_CLK_SYS_PLL_PFD1_DIV2>;
 	assigned-clock-rates = <400000000>, <133333334>;
 };
+
+&dphy {
+	/delete-property/ power-domains;
+};
diff --git a/arch/arm/dts/ucm-imx93.dts b/arch/arm/dts/ucm-imx93.dts
index 6ae4b6165c..4e95998a19 100644
--- a/arch/arm/dts/ucm-imx93.dts
+++ b/arch/arm/dts/ucm-imx93.dts
@@ -31,15 +31,6 @@
 		};
 	};
 
-	reg_can2_stby: regulator-can2-stby {
-		compatible = "regulator-fixed";
-		regulator-name = "can2-stby";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&adp5585gpio 5 GPIO_ACTIVE_LOW>;
-		enable-active-low;
-	};
-
 	reg_usdhc2_vmmc: regulator-usdhc2 {
 		compatible = "regulator-fixed";
 		pinctrl-names = "default";
@@ -67,20 +58,30 @@
 		status = "okay";
 	};
 
-	rm67199_panel {
-		compatible = "raydium,rm67199";
-		reset-gpio = <&adp5585gpio 6 GPIO_ACTIVE_LOW>;
+	ili9881c_panel {
+		compatible = "startek,ili9881c";
+		reset-gpio = <&pca9555 4 GPIO_ACTIVE_LOW>;
 		dsi-lanes = <4>;
-		video-mode = <2>;	/* 0: burst mode
-					 * 1: non-burst mode with sync event
-					 * 2: non-burst mode with sync pulse
-					 */
-		width-mm = <68>;
-		height-mm = <121>;
+		panel-width-mm = <63>;
+		panel-height-mm = <115>;
 		status = "okay";
 
+		display-timings {
+			native-mode = <&timing1>;
+			timing1: timing1 {
+				clock-frequency = <62000000>;
+				hactive = <1280>;
+				vactive = <720>;
+				hfront-porch = <30>;
+				hback-porch = <10>;
+				hsync-len = <20>;
+				vback-porch = <20>;
+				vfront-porch = <10>;
+				vsync-len = <10>;
+			};
+		};
 		port {
-			panel_in: endpoint {
+			ili9881c_from_dsim: endpoint {
 				remote-endpoint = <&dsi_out>;
 			};
 		};
@@ -96,14 +97,8 @@
 
 	ports {
 		port@1 {
-			dsi_to_adv7535: endpoint {
-				remote-endpoint = <&adv7535_to_dsi>;
-			};
-		};
-
-		port@2 {
 			dsi_out: endpoint {
-				remote-endpoint = <&panel_in>;
+				remote-endpoint = <&ili9881c_from_dsim>;
 			};
 		};
 	};
@@ -123,19 +118,12 @@
 	pinctrl-1 = <&pinctrl_lpi2c1>;
 	status = "okay";
 
-	adv7535: hdmi@3d {
-		compatible = "adi,adv7535";
-		reg = <0x3d>;
-		adi,addr-cec = <0x3c>;
-		adi,dsi-lanes = <4>;
-		status = "okay";
-
-		port {
-			adv7535_to_dsi: endpoint {
-				remote-endpoint = <&dsi_to_adv7535>;
-			};
-		};
-	};
+        pca9555:pca9555@20 {
+                compatible = "nxp,pca9555";
+                gpio-controller;
+                #gpio-cells = <2>;
+                reg = <0x20>;
+        };
 };
 
 &lpi2c2 {
@@ -238,13 +226,6 @@
 			};
 		};
 	};
-
-	adp5585gpio: gpio@34 {
-		compatible = "adp5585";
-		reg = <0x34>;
-		gpio-controller;
-		#gpio-cells = <2>;
-	};
 };
 
 &lpi2c3 {
@@ -369,7 +350,6 @@
 &flexcan2 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_flexcan2>;
-	xceiver-supply = <&reg_can2_stby>;
 	status = "okay";
 };
 
-- 
2.17.1

