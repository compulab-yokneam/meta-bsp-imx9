From e9e3c1a5b4ccbce34a11a85e797c649fb936ebc7 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Tue, 6 Jun 2023 11:44:56 +0300
Subject: [PATCH] ucm-imx93: Read both mac addresses from the som eeprom

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 board/compulab/ucm-imx93/ucm-imx93.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/board/compulab/ucm-imx93/ucm-imx93.c b/board/compulab/ucm-imx93/ucm-imx93.c
index c3b95ea4ca..ceb6eda38c 100644
--- a/board/compulab/ucm-imx93/ucm-imx93.c
+++ b/board/compulab/ucm-imx93/ucm-imx93.c
@@ -128,6 +128,17 @@ static void board_gpio_init(void)
 	dm_gpio_set_value(&desc, 1);
 }
 
+#if defined(CONFIG_FEC_MXC) || defined(CONFIG_DWC_ETH_QOS)
+static void board_get_mac_from_eeprom(int dev_id) {
+	unsigned char mac[6];
+	cl_eeprom_read_n_mac_addr(mac, dev_id, CONFIG_SYS_I2C_EEPROM_BUS);
+	eth_env_set_enetaddr_by_index("eth",dev_id,mac);
+	return;
+}
+#else
+static void board_get_mac_from_eeprom(int dev_id) { return;}
+#endif
+
 int board_init(void)
 {
 	if (CONFIG_IS_ENABLED(FEC_MXC))
@@ -156,6 +167,9 @@ int board_late_init(void)
 	env_set("board_name", "UCM-iMX93");
 	env_set("board_rev", "iMX93");
 #endif
+	board_get_mac_from_eeprom(0);
+	board_get_mac_from_eeprom(1);
+
 	return 0;
 }
 
-- 
2.17.1

