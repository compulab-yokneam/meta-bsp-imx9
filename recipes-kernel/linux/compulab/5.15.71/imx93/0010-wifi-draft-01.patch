From f4b8a633743596a36d5b741e851ac3b31b7ce626 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Sun, 9 Apr 2023 15:25:20 +0300
Subject: [PATCH] wifi: draft #01

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/ucm-imx93.dts | 52 +++++++++++++++++++---
 1 file changed, 47 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93.dts b/arch/arm64/boot/dts/compulab/ucm-imx93.dts
index b1c4778bda1f..3d5de4791be1 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx93.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93.dts
@@ -134,6 +134,18 @@
 		enable-active-high;
 		regulator-always-on;
 	};
+
+	reg_btregon: regulator-btregon {
+		compatible = "regulator-fixed";
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_reg_btregon>;
+		regulator-name = "btregon_VSD_3V3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		gpio = <&gpio1 18 GPIO_ACTIVE_HIGH>;
+		enable-active-high;
+		regulator-always-on;
+	};
 #endif
 
 	sound-micfil {
@@ -505,9 +517,24 @@
 &lpuart5 {
 	/* BT */
 	pinctrl-names = "default";
-	/*pinctrl-assert-gpios = <&pcal6524 19 GPIO_ACTIVE_HIGH>;*/
+	pinctrl-assert-gpios = <&gpio1 16 GPIO_ACTIVE_HIGH>;
 	pinctrl-0 = <&pinctrl_uart5>;
+	fsl,uart-has-rtscts;
 	status = "okay";
+#if 0
+	#address-cells = <1>;
+	#size-cells = <0>;
+	btmrvl: btmrvl@1 {
+		compatible = "marvell,sd8897-bt";
+		reg = <1>;
+#if 0
+		interrupt-parent = <&pio>;
+		interrupts = <119 IRQ_TYPE_LEVEL_LOW>;
+		marvell,wakeup-pin = /bits/ 16 <0x0d>;
+		marvell,wakeup-gap-ms = /bits/ 16 <0x64>;
+#endif
+	};
+#endif
 };
 
 &mu1 {
@@ -572,6 +599,7 @@
 	pinctrl-0 = <&pinctrl_usdhc3>, <&pinctrl_usdhc3_wlan>;
 	pinctrl-1 = <&pinctrl_usdhc3>, <&pinctrl_usdhc3_wlan>;
 	pinctrl-2 = <&pinctrl_usdhc3>, <&pinctrl_usdhc3_wlan>;
+	/*vmmc-supply = <&reg_usdhc3_vmmc>;*/
 	bus-width = <4>;
 	non-removable;
 	wakeup-source;
@@ -582,6 +610,13 @@
 		compatible = "marvell,sd8997";
 		reg = <1>;
 	};
+
+#if 0
+	btmrvl: btmrvl@2 {
+		compatible = "marvell,sd8897-bt";
+		reg = <2>;
+	};
+#endif
 };
 
 &iomuxc {
@@ -668,10 +703,11 @@
 
 	pinctrl_uart5: uart5grp {
 		fsl,pins = <
-			MX93_PAD_DAP_TDO_TRACESWO__LPUART5_TX	0x31e
-			MX93_PAD_DAP_TDI__LPUART5_RX		0x31e
-			MX93_PAD_DAP_TMS_SWDIO__LPUART5_RTS_B	0x31e
-			MX93_PAD_DAP_TCLK_SWCLK__LPUART5_CTS_B	0x31e
+			MX93_PAD_GPIO_IO01__LPUART5_RX		0x31e
+			MX93_PAD_GPIO_IO00__LPUART5_TX		0x31e
+			MX93_PAD_GPIO_IO02__LPUART5_CTS_B	0x31e
+			MX93_PAD_GPIO_IO03__LPUART5_RTS_B	0x31e
+			MX93_PAD_GPIO_IO16__GPIO2_IO16		0x31e
 		>;
 	};
 
@@ -732,6 +768,12 @@
 		>;
 	};
 
+	pinctrl_reg_btregon: reg_btrego {
+		fsl,pins = <
+			MX93_PAD_GPIO_IO18__GPIO2_IO18			0x31e
+		>;
+	};
+
 	pinctrl_usdhc3_wlan: usdhc3wlangrp {
 		fsl,pins = <
 			MX93_PAD_CCM_CLKO1__GPIO3_IO26			0x31e
-- 
2.17.1

