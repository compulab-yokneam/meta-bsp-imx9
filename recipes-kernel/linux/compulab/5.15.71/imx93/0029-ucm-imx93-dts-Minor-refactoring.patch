From dc9e4f63e75c950f95a7193d2fef8d3be4e1dd8d Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Sun, 7 May 2023 09:16:22 +0300
Subject: [PATCH] ucm-imx93: dts: Minor refactoring

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/Makefile         |  1 +
 .../boot/dts/compulab/ucm-imx93-headless.dts  | 15 +++
 .../boot/dts/compulab/ucm-imx93-lvds.dts      | 71 +-------------
 .../boot/dts/compulab/ucm-imx93-lvds.dtsi     | 81 ++++++++++++++++
 .../boot/dts/compulab/ucm-imx93-mipi.dts      | 89 +-----------------
 .../boot/dts/compulab/ucm-imx93-mipi.dtsi     | 94 +++++++++++++++++++
 arch/arm64/boot/dts/compulab/ucm-imx93.dts    |  5 +-
 7 files changed, 197 insertions(+), 159 deletions(-)
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx93-headless.dts
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dtsi
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dtsi

diff --git a/arch/arm64/boot/dts/compulab/Makefile b/arch/arm64/boot/dts/compulab/Makefile
index 81e131950b80..45aa0b03875c 100644
--- a/arch/arm64/boot/dts/compulab/Makefile
+++ b/arch/arm64/boot/dts/compulab/Makefile
@@ -34,6 +34,7 @@ dtb-$(CONFIG_ARCH_MXC) += som-imx8m-plus-usbdev.dtb
 
 # i.MX9
 dtb-$(CONFIG_SOC_IMX9) += ucm-imx93.dtb
+dtb-$(CONFIG_SOC_IMX9) += ucm-imx93-headless.dtb
 # i.MX9 overlays
 DTC_FLAGS := -@
 dtb-$(CONFIG_SOC_IMX9) += ucm-imx93-lvds.dtbo
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93-headless.dts b/arch/arm64/boot/dts/compulab/ucm-imx93-headless.dts
new file mode 100644
index 000000000000..71fce1a00b95
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93-headless.dts
@@ -0,0 +1,15 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright 2023 Compulab
+ */
+
+/dts-v1/;
+
+#include <dt-bindings/usb/pd.h>
+#include "../freescale/imx93.dtsi"
+#include "ucm-imx93.dtsi"
+
+/ {
+	model = "CompuLab UCM-i.MX93 board, headless";
+	compatible = "compulab,ucm-imx93", "fsl,imx93";
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dts b/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dts
index ed6440bb5b5f..2a717645b8a8 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dts
@@ -7,75 +7,8 @@
 /plugin/;
 
 #include <dt-bindings/gpio/gpio.h>
+#include "ucm-imx93-lvds.dtsi"
 
 / {
-	lvds_backlight: lvds_backlight {
-		compatible = "pwm-backlight";
-		/*pwms = <&pwm2 0 3000000 0>;*/
-		status = "okay";
-
-		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
-					17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32
-					33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48
-					49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64
-					65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80
-					81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96
-					97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112
-					113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128
-					129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
-					145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160
-					161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176
-					177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192
-					193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208
-					209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224
-					225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240
-					241 242 243 244 245 246 247 248 249 250 251 252 253 254 255>;
-		default-brightness-level = <222>;
-	};
-
-	lvds0_panel {
-		compatible = "boe,hv070wsa-100";
-		backlight = <&lvds_backlight>;
-		enable-gpios = <&pca9555 6 GPIO_ACTIVE_HIGH>;
-
-		port {
-			panel_lvds_in: endpoint {
-				remote-endpoint = <&lvds_out>;
-			};
-		};
-	};
-};
-
-&dphy {
-	status = "disabled";
-};
-
-&dsi {
-	status = "disabled";
-};
-
-&lcdif {
-	assigned-clock-rates = <498000000>, <71142857>, <400000000>, <133333333>;
-};
-
-&ldb {
-	status = "okay";
-
-	lvds-channel@0 {
-		#address-cells = <1>;
-		#size-cells = <0>;
-		status = "okay";
-
-		port@1 {
-			reg = <1>;
-
-			lvds_out: endpoint {
-				remote-endpoint = <&panel_lvds_in>;
-			};
-		};
-	};
-};
-
-&ldb_phy {
-	status = "okay";
+	model = "CompuLab UCM-i.MX93 board, lvds-overalay";
 };
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dtsi
new file mode 100644
index 000000000000..ed6440bb5b5f
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93-lvds.dtsi
@@ -0,0 +1,81 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright 2022 NXP
+ */
+
+/dts-v1/;
+/plugin/;
+
+#include <dt-bindings/gpio/gpio.h>
+
+/ {
+	lvds_backlight: lvds_backlight {
+		compatible = "pwm-backlight";
+		/*pwms = <&pwm2 0 3000000 0>;*/
+		status = "okay";
+
+		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
+					17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32
+					33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48
+					49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64
+					65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80
+					81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96
+					97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112
+					113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128
+					129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
+					145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160
+					161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176
+					177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192
+					193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208
+					209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224
+					225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240
+					241 242 243 244 245 246 247 248 249 250 251 252 253 254 255>;
+		default-brightness-level = <222>;
+	};
+
+	lvds0_panel {
+		compatible = "boe,hv070wsa-100";
+		backlight = <&lvds_backlight>;
+		enable-gpios = <&pca9555 6 GPIO_ACTIVE_HIGH>;
+
+		port {
+			panel_lvds_in: endpoint {
+				remote-endpoint = <&lvds_out>;
+			};
+		};
+	};
+};
+
+&dphy {
+	status = "disabled";
+};
+
+&dsi {
+	status = "disabled";
+};
+
+&lcdif {
+	assigned-clock-rates = <498000000>, <71142857>, <400000000>, <133333333>;
+};
+
+&ldb {
+	status = "okay";
+
+	lvds-channel@0 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		status = "okay";
+
+		port@1 {
+			reg = <1>;
+
+			lvds_out: endpoint {
+				remote-endpoint = <&panel_lvds_in>;
+			};
+		};
+	};
+};
+
+&ldb_phy {
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dts b/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dts
index e16c1255b14c..bd3e7e87e360 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dts
@@ -7,93 +7,8 @@
 /plugin/;
 
 #include <dt-bindings/gpio/gpio.h>
+#include "ucm-imx93-mipi.dtsi"
 
 / {
-	dsi_backlight: dsi_backlight {
-		compatible = "pwm-backlight";
-		/*pwms = <&pwm1 0 3000000 0>;*/
-		status = "okay";
-
-		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
-					17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32
-					33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48
-					49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64
-					65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80
-					81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96
-					97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112
-					113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128
-					129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
-					145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160
-					161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176
-					177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192
-					193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208
-					209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224
-					225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240
-					241 242 243 244 245 246 247 248 249 250 251 252 253 254 255>;
-		default-brightness-level = <222>;
-	};
-};
-
-&ldb {
-	status = "disabled";
-};
-
-&ldb_phy {
-	status = "disabled";
-};
-
-&lcdif {
-	assigned-clock-rates = <484000000>, <121000000>, <400000000>, <133333333>;
-	status = "okay";
-};
-
-&dsi {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	status = "okay";
-	panel@0 {
-		compatible = "startek,kd050hdfia020";
-		backlight = <&dsi_backlight>;
-		reset-gpio = <&pca9555 4 GPIO_ACTIVE_LOW>;
-		reg = <0>;
-		dsi-lanes = <4>;
-		panel-width-mm = <63>;
-		panel-height-mm = <115>;
-		status = "okay";
-
-		panel-timing {
-				clock-frequency = <60000000>;
-				/*X*/
-				hsync-len     = <10>;
-				hback-porch   = <10>;
-				hactive       = <720>;
-				hfront-porch  = <20>;
-				/*Y*/
-				vsync-len     = <20>;
-				vback-porch   = <30>;
-				vactive       = <1280>;
-				vfront-porch  = <10>;
-		};
-		port {
-			panel_in: endpoint {
-				remote-endpoint = <&dsi_out>;
-			};
-		};
-	};
-
-	ports {
-		#address-cells = <1>;
-		#size-cells = <0>;
-		port@1 {
-			reg = <1>;
-
-			dsi_out: endpoint {
-				remote-endpoint = <&panel_in>;
-			};
-		};
-	};
-};
-
-&dphy {
-	status = "okay";
+	model = "CompuLab UCM-i.MX93 board, mipi-overalay";
 };
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dtsi
new file mode 100644
index 000000000000..b9eca0e8d447
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93-mipi.dtsi
@@ -0,0 +1,94 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright 2022 NXP
+ */
+
+/ {
+	dsi_backlight: dsi_backlight {
+		compatible = "pwm-backlight";
+		/*pwms = <&pwm1 0 3000000 0>;*/
+		status = "okay";
+
+		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
+					17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32
+					33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48
+					49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64
+					65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80
+					81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96
+					97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112
+					113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128
+					129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
+					145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160
+					161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176
+					177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192
+					193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208
+					209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224
+					225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240
+					241 242 243 244 245 246 247 248 249 250 251 252 253 254 255>;
+		default-brightness-level = <222>;
+	};
+};
+
+&ldb {
+	status = "disabled";
+};
+
+&ldb_phy {
+	status = "disabled";
+};
+
+&lcdif {
+	assigned-clock-rates = <484000000>, <121000000>, <400000000>, <133333333>;
+	status = "okay";
+};
+
+&dsi {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+	panel@0 {
+		compatible = "startek,kd050hdfia020";
+		backlight = <&dsi_backlight>;
+		reset-gpio = <&pca9555 4 GPIO_ACTIVE_LOW>;
+		reg = <0>;
+		dsi-lanes = <4>;
+		panel-width-mm = <63>;
+		panel-height-mm = <115>;
+		status = "okay";
+
+		panel-timing {
+				clock-frequency = <60000000>;
+				/*X*/
+				hsync-len     = <10>;
+				hback-porch   = <10>;
+				hactive       = <720>;
+				hfront-porch  = <20>;
+				/*Y*/
+				vsync-len     = <20>;
+				vback-porch   = <30>;
+				vactive       = <1280>;
+				vfront-porch  = <10>;
+		};
+		port {
+			panel_in: endpoint {
+				remote-endpoint = <&dsi_out>;
+			};
+		};
+	};
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		port@1 {
+			reg = <1>;
+
+			dsi_out: endpoint {
+				remote-endpoint = <&panel_in>;
+			};
+		};
+	};
+};
+
+&dphy {
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx93.dts b/arch/arm64/boot/dts/compulab/ucm-imx93.dts
index f8ef5b9a533c..ae61d23704a2 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx93.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx93.dts
@@ -5,11 +5,10 @@
 
 /dts-v1/;
 
-#include <dt-bindings/usb/pd.h>
-#include "../freescale/imx93.dtsi"
 #include "ucm-imx93.dtsi"
+#include "ucm-imx93-mipi.dtsi"
 
 / {
-	model = "CompuLab UCM-i.MX93 board";
+	model = "CompuLab UCM-i.MX93 board, build-in-mipi";
 	compatible = "compulab,ucm-imx93", "fsl,imx93";
 };
-- 
2.17.1

